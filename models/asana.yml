version: 2

models:

  # enriched core object tables
  - name: asana_task
    description: An enriched task table consisting of base task info + aggregated metrics and lists 
    columns:

      - name: task_id
        description: System generated unique ID of the task.
        tests:
          - unique
          - not_null

      - name: task_name
        description: User-facing name of the task
      
      - name: assignee_user_id
        description: Foreign key referencing the ASANA_USER that is currently assigned the task.

      - name: assignee_name
        description: Name of the user that the task is currently assigned to.

      - name: assignee_email
        description: Email of the user that the task is currently assigned to.

      - name: assignee_status
        description: Scheduling status for the assignee that the task is or will eventually be assigned to. This maps to the sections of "My Tasks"

      - name: is_completed
        description: Boolean that is true if the task is currently marked complete.

      - name: completed_at
        description: Timestamp of when the task was marked complete.

      - name: completed_by_user_id
        description: Foreign key referencing the USER who completed the task.

      - name: created_at
        description: Timestamp of when the task was created

      - name: due_date
        description: Date the task is due, if provided.

      - name: modified_at # TODO: rename last_modified_at?
        description: Timestamp of when the task was last modified

      - name: start_date
        description: The start date of the task, if a date range is given.

      - name: task_description
        description: Free-form text describing the task, as seen in the UI.

      - name: days_open
        description: The number of days the task has been/was open (creation -> completion)

      - name: is_currently_assigned
        description: Boolean, true if the task is *currently* assigned
      
      - name: has_been_assigned
        description: Boolean, true if the task has at one point been assigned, even if currently not.

      - name: days_since_last_assignment
        description: The number of days the task has been/was open and assigned to to the most recent user (last assignment -> completion)

      - name: days_since_first_assignment
        description: The number of days the task has been/was open and assigned at all (first time assigned -> completion)
      
      - name: last_assigned_at
        description: Timestamp of when the task was last assigned (to the current user if still assigned)
      
      - name: first_assigned_At
        description: Timestamp of when the task was first assigned to someone

      - name: first_modifier_user_id
        description: Foreign key referencing the ASANA_USER who made the first modification to the task (ie added a description). Somewhat of a proxy for task creator.
      
      - name: first_modifier_name
        description: Name of the user who made the first modification to the task

      - name: number_of_comments
        description: Count of comments made on the task
      
      - name: conversation
        description: The task's comments and authors aggregated into an ordered conversation

      - name: followers
        description: A list of the names of the users who follow the task.

      - name: number_of_followers
        description: Count of the users following the task

      - name: tags
        description: A list of the tags associated with the task.

      - name: number_of_tags
        description: Count of the tags associated with the task.

      - name: teams
        description: A list of the teams associated with the task

      - name: projects
        description: A list of the projects that this task is listed under.

      - name: sections
        description: A list of the sections that the task lives in

      - name: is_subtask
        description: Boolean that's true if the task is a subtask of another.
      
      - name: parent_task_id
        description: Self-referential id of the parent TASK that this is a subtask of.

      - name: parent_name # TODO: maybe rename parent_task_name
        description: User-facing name of the task's parent task.

      - name: parent_assignee_user_id
        description: Foreign key referencing the ASANA_USER who is assigned the parent task

      - name: parent_assignee_name
        description: Name of the user assigned this task's parent task

      - name: parent_due_date
        description: Date on which the parent task is due, if given

      - name: parent_created_at
        description: Timestamp of when the parent task was created


  - name: asana_user
    description: Enriched user table consisting of base user info + metrics around tasks and completions
    columns:

      - name: user_id
        description: System generated unique ID of the user
        tests:
          - unique
          - not_null
      
      - name: user_name
        description: Name of the user as it appears in the UI
      
      - name: email
        description: The user's email

      - name: last_completed_task_id # TODO: should this include tasks that they completed but were not assigned to....
        description: Foreign key referencing the last ASANA_TASK that the user was assigned to and completed.

      - name: next_due_task_id
        description: Foreign key referencing the next due (earliest due-date) ASANA_TASK that the user is assigned

      - name: last_completed_task_name
        description: User-facing name of the last task the user completed (and was assigned to)

      - name: next_due_task_name
      
      - name: last_completed_task_projects
        description: Projects that the user's last completed task belonged to.

      - name: next_due_task_projects

      - name: last_completed_task_teams
        description: Teams associated with the user's last completed task.

      - name: next_due_task_teams

      - name: last_completed_task_tags
        description: Tags associated with the user's last completed task.

      - name: next_due_task_tags

      - name: last_completed_due_date
        description: Due date of the last completed task

      - name: next_due_due_date

      - name: last_completed_days_assigned_this_user
        description: Days that the task was open and assigned this user before they completed it.
      
      - name: next_due_days_assigned_this_user
        description: Days that the next due task has spent open and assigned to this user

      - name: last_completed_at
        description: Timestamp of when the user last completed a task.

      - name: number_of_open_tasks
        description: Count of the currently open tasks assigned to this user

      - name: number_of_tasks_completed
        description: Count of the tasks that this user has completed

      - name: avg_close_time_days
        description: The avg number of days it has taken the user to complete tasks once assigned to them.

      - name: number_of_open_tasks_followed
        description: Count of the open tasks that the user is currently following.
      
      - name: number_of_projects_owned
        description: Count of the projects that this user is the owner of (excludes archived projects)

      - name: number_of_projects_currently_assigned_to
        description: Count of the projects that the user is currently assigned open tasks to.
      
      - name: projects_working_on
        description: Aggregated list of the projects that the user is currently assigned to or owns.


  - name: asana_project
    description: Table of projects' basic info enriched with metrics regarding tasks and completions
    columns:

      - name: project_id
        description: System-generated unique ID of the project.
        tests:
          - unique
          - not_null
      
      - name: project_name
        description: UI-facing name of the project

      
  - name: asana_team
  - name: asana_tag

  - name: asana_task_history
  - name: asana_project_history
  - name: asana_daily_metrics